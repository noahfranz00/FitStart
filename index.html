<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>FitStart — AI Fitness Plans</title>
<meta name="application-name" content="FitStart">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="FitStart">
<meta name="theme-color" content="#0a0a0a">
<meta name="mobile-web-app-capable" content="yes">
<meta name="description" content="AI-powered fitness plans, workout tracking, and nutrition logging.">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Syne:wght@400;500;700;800&family=DM+Mono:wght@300;400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/styles.css">
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    // Inline service worker for offline caching
    const swCode = `
self.addEventListener('install', e => self.skipWaiting());
self.addEventListener('activate', e => e.waitUntil(clients.claim()));
self.addEventListener('fetch', e => {
  if (e.request.mode === 'navigate') {
    e.respondWith(fetch(e.request).catch(() => caches.match('/')));
  }
});
`;
    const blob = new Blob([swCode], {type: 'application/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl, {scope: '/'}).catch(() => {});
  });
}
</script>
<script>
// Generate PWA icon via canvas and inject as apple-touch-icon
(function() {
  try {
    const c = document.createElement('canvas');
    c.width = 512; c.height = 512;
    const ctx = c.getContext('2d');
    // Background
    const bg = ctx.createLinearGradient(0,0,512,512);
    bg.addColorStop(0,'#111111'); bg.addColorStop(1,'#0a0a0a');
    ctx.fillStyle = bg;
    roundRect(ctx, 0, 0, 512, 512, 90);
    ctx.fill();
    // Dumbbell shape in green
    ctx.fillStyle = '#4ADE80';
    ctx.shadowColor = '#4ADE80'; ctx.shadowBlur = 20;
    // Left plate
    roundRect(ctx, 52, 188, 80, 136, 20); ctx.fill();
    // Left collar
    roundRect(ctx, 128, 208, 48, 96, 12); ctx.fill();
    // Bar
    roundRect(ctx, 172, 238, 168, 36, 8); ctx.fill();
    // Right collar
    roundRect(ctx, 336, 208, 48, 96, 12); ctx.fill();
    // Right plate
    roundRect(ctx, 380, 188, 80, 136, 20); ctx.fill();
    // "FS" text
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 72px system-ui, -apple-system, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('FS', 256, 440);

    function roundRect(ctx, x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.lineTo(x+w-r, y);
      ctx.quadraticCurveTo(x+w, y, x+w, y+r);
      ctx.lineTo(x+w, y+h-r);
      ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
      ctx.lineTo(x+r, y+h);
      ctx.quadraticCurveTo(x, y+h, x, y+h-r);
      ctx.lineTo(x, y+r);
      ctx.quadraticCurveTo(x, y, x+r, y);
      ctx.closePath();
    }

    const iconUrl = c.toDataURL('image/png');
    // Inject apple-touch-icon
    ['180', '152', '167', '120'].forEach(size => {
      const link = document.createElement('link');
      link.rel = 'apple-touch-icon';
      link.setAttribute('sizes', size + 'x' + size);
      link.href = iconUrl;
      document.head.appendChild(link);
    });
    // Inject manifest with proper icon
    const manifest = {
      name: 'FitStart',
      short_name: 'FitStart',
      description: 'AI fitness plans and workout tracking',
      start_url: './',
      display: 'standalone',
      background_color: '#0a0a0a',
      theme_color: '#0a0a0a',
      orientation: 'portrait-primary',
      icons: [
        { src: iconUrl, sizes: '192x192', type: 'image/png', purpose: 'any maskable' },
        { src: iconUrl, sizes: '512x512', type: 'image/png', purpose: 'any maskable' }
      ]
    };
    const blob = new Blob([JSON.stringify(manifest)], {type:'application/manifest+json'});
    const mLink = document.createElement('link');
    mLink.rel = 'manifest';
    mLink.href = URL.createObjectURL(blob);
    document.head.appendChild(mLink);
  } catch(e) { console.log('Icon gen error:', e); }
})();
</script>
</head>
<body>

<!-- ══════════ ONBOARDING ══════════ -->
<div id="screen-onboard" class="screen active">
<nav>
  <div class="logo">FIT<span class="logo-dot" id="ob-logo-dot">●</span>START</div>
  <div class="nav-right">
    <div class="nav-pill">AI-Powered</div>
    <button class="nav-cta" onclick="document.getElementById('form-section').scrollIntoView({behavior:'smooth'})">Build My Plan</button>
  </div>
</nav>

<section id="hero-section" class="hero">
  <div class="hero-eyebrow"><span class="eyebrow-line"></span>Personalized fitness at every level</div>
  <div id="ob-headline">
    TRAIN<br>
    <span class="line-accent" id="ob-accent">SMARTER,</span>
    <span id="ob-headline-line3">NOT HARDER</span>
  </div>
  <p class="hero-sub">Tell us where you are and we'll build a plan that gets you where you want to go — whether you're just starting out or chasing a new personal best.</p>
  <div class="tier-selector">
    <button class="tier-btn active" data-tier="beginner" onclick="setTier('beginner',this)">
      <div class="tier-label">Beginner</div><div class="tier-desc">Just starting out, building the habit</div>
      <div class="tier-dots"><div class="tier-dot"></div><div class="tier-dot"></div><div class="tier-dot"></div></div>
    </button>
    <button class="tier-btn" data-tier="intermediate" onclick="setTier('intermediate',this)">
      <div class="tier-label">Intermediate</div><div class="tier-desc">6+ months in, ready to level up</div>
      <div class="tier-dots"><div class="tier-dot"></div><div class="tier-dot"></div><div class="tier-dot"></div></div>
    </button>
    <button class="tier-btn" data-tier="advanced" onclick="setTier('advanced',this)">
      <div class="tier-label">Advanced</div><div class="tier-desc">2+ years, chasing peak performance</div>
      <div class="tier-dots"><div class="tier-dot"></div><div class="tier-dot"></div><div class="tier-dot"></div></div>
    </button>
  </div>
</section>

<div class="main-layout" id="form-section">
  <div class="form-card">
    <div class="form-header">
      <div class="form-title">Build My Plan</div>
      <div class="tier-badge" id="tierBadge">● Beginner</div>
    </div>

    <div class="form-section-label">About You</div>
    <div class="form-row">
      <div class="form-group"><label>First Name</label><input type="text" id="ob-name" placeholder="e.g. Jake"></div>
      <div class="form-group"><label>Age</label><input type="number" id="ob-age" placeholder="e.g. 28" min="16" max="80"></div>
      <div class="form-group"><label>Gender</label>
        <select id="ob-gender">
          <option value="">Select...</option>
          <option>Male</option><option>Female</option><option>Prefer not to say</option>
        </select>
      </div>
      <div class="form-group"><label>Height</label>
        <div style="display:flex;gap:6px">
          <select id="ob-height-ft" style="flex:1">
            <option value="">ft</option>
            <option>4</option><option>5</option><option>6</option><option>7</option>
          </select>
          <select id="ob-height-in" style="flex:1">
            <option value="">in</option>
            <option>0</option><option>1</option><option>2</option><option>3</option><option>4</option>
            <option>5</option><option>6</option><option>7</option><option>8</option><option>9</option>
            <option>10</option><option>11</option>
          </select>
        </div>
      </div>
      <div class="form-group"><label>Current Weight (lbs)</label><input type="number" id="ob-weight" placeholder="e.g. 235"></div>
      <div class="form-group"><label>Goal Weight (lbs)</label><input type="number" id="ob-goal" placeholder="e.g. 215"></div>
      <div class="form-group" style="grid-column:1/-1"><label>Activity Level (outside gym)</label>
        <select id="ob-activity">
          <option value="">Select...</option>
          <option value="sedentary">Sedentary — desk job, little movement</option>
          <option value="light">Lightly Active — on feet some of the day</option>
          <option value="moderate">Moderately Active — physical job or daily walks</option>
          <option value="very">Very Active — labor job, sports, highly active</option>
        </select>
      </div>
    </div>

    <div class="form-section-label">Training Details</div>
    <div class="form-row">
      <div class="form-group" style="grid-column:1/-1"><label>Available Equipment</label>
        <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:4px" id="ob-equipment-picker">
          <div class="day-pill" data-equip="Full Gym">Full Gym</div>
          <div class="day-pill" data-equip="Barbells">Barbells</div>
          <div class="day-pill" data-equip="Dumbbells">Dumbbells</div>
          <div class="day-pill" data-equip="Cables">Cables</div>
          <div class="day-pill" data-equip="Machines">Machines</div>
          <div class="day-pill" data-equip="Kettlebells">Kettlebells</div>
          <div class="day-pill" data-equip="Resistance Bands">Bands</div>
          <div class="day-pill" data-equip="Bodyweight Only">Bodyweight Only</div>
        </div>
      </div>
      <div class="form-group" style="grid-column:1/-1"><label>Injuries or Limitations <span style="color:var(--dim);font-weight:400;text-transform:none;letter-spacing:0">(optional)</span></label>
        <input type="text" id="ob-injuries" placeholder="e.g. bad knees, lower back pain, shoulder impingement">
      </div>
    </div>

    <div class="form-section-label">Goal Timeline</div>
    <div class="timeline-selector" id="timeline-selector">
      <div class="tl-btn" data-weeks="12" onclick="selectTimeline(this)">12 Weeks<br><small style="font-size:0.62rem;opacity:0.6">Aggressive</small></div>
      <div class="tl-btn active" data-weeks="16" onclick="selectTimeline(this)">16 Weeks<br><small style="font-size:0.62rem;opacity:0.6">Balanced</small></div>
      <div class="tl-btn" data-weeks="24" onclick="selectTimeline(this)">24 Weeks<br><small style="font-size:0.62rem;opacity:0.6">Sustainable</small></div>
      <div class="tl-btn" data-weeks="36" onclick="selectTimeline(this)">36 Weeks<br><small style="font-size:0.62rem;opacity:0.6">Gradual</small></div>
    </div>

    <div class="form-section-label">Training Split</div>
    <div class="split-selector" id="split-selector">
      <div class="split-btn active" data-split="ppl" onclick="selectSplit(this)">
        <div class="split-btn-title">Push / Pull / Legs</div>
        <div class="split-btn-desc">Classic 3-way split, best for 4–6 days</div>
      </div>
      <div class="split-btn" data-split="ul" onclick="selectSplit(this)">
        <div class="split-btn-title">Upper / Lower</div>
        <div class="split-btn-desc">Balanced split, great for 3–4 days</div>
      </div>
      <div class="split-btn" data-split="fb" onclick="selectSplit(this)">
        <div class="split-btn-title">Full Body</div>
        <div class="split-btn-desc">Hit everything each session, 2–3 days</div>
      </div>
      <div class="split-btn" data-split="ai" onclick="selectSplit(this)">
        <div class="split-btn-title">AI Generated</div>
        <div class="split-btn-desc">Let us build the optimal split for you</div>
      </div>
    </div>

    <div class="form-section-label">Your Schedule</div>
    <div class="form-group" style="margin-bottom:12px">
      <label>Gym Days <span id="day-count-label" style="color:var(--dim);font-weight:400;text-transform:none;letter-spacing:0"></span></label>
      <div class="day-picker" id="ob-day-picker">
        <div class="day-pill" data-day="Monday">Mon</div>
        <div class="day-pill" data-day="Tuesday">Tue</div>
        <div class="day-pill" data-day="Wednesday">Wed</div>
        <div class="day-pill" data-day="Thursday">Thu</div>
        <div class="day-pill" data-day="Friday">Fri</div>
        <div class="day-pill" data-day="Saturday">Sat</div>
        <div class="day-pill" data-day="Sunday">Sun</div>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group" style="grid-column:1/-1"><label>Session Length</label>
        <select id="ob-duration">
          <option value="">Select...</option>
          <option>20–30 min</option><option>30–45 min</option><option>45–60 min</option><option>60–90 min</option>
        </select>
      </div>
    </div>

    <button class="btn-generate" id="generateBtn" onclick="generatePlan()">GENERATE MY PLAN</button>
    <p class="price-note">7-day free trial · Then $29.99/month · Cancel anytime</p>
  </div>

  <div class="sidebar-info">
    <div class="info-card">
      <div class="info-card-label" id="sidebar-label">What You Get — Beginner</div>
      <div id="tier-features"></div>
    </div>
  </div>
</div>

<div class="loading-wrap" id="loading">
  <div class="loader"><div class="loader-bar"></div><div class="loader-bar"></div><div class="loader-bar"></div><div class="loader-bar"></div><div class="loader-bar"></div></div>
  <p>Building your personalized plan...</p>
  <small id="loading-detail">Analyzing your profile</small>
</div>

<section id="results-section">
  <div class="cta-into-app" style="margin:0">
    <h3>YOUR PLAN IS READY</h3>
    <p>Start your full program, track macros, and log every workout inside the app.</p>
    <button class="btn-enter-app" onclick="goToDash()">ENTER THE APP →</button>
    <p class="cta-fine">7-day free trial · Then $29.99/month · Cancel anytime</p>
  </div>
  <!-- Hidden plan data for My Plan tab -->
  <div id="results-grid" style="display:none"></div>
  <div id="week-card" style="display:none"></div>
  <div id="results-banner" style="display:none"><h2 id="plan-name"></h2><p id="plan-tagline"></p><div id="results-tier-badge"></div></div>
</section>
</div><!-- /screen-onboard -->


<!-- ══════════ SIGNUP ══════════ -->
<div id="screen-signup" class="screen">
<nav>
  <div class="logo">FIT<span class="logo-dot" id="su-logo-dot">●</span>START</div>
  <div class="nav-right">
    <div class="nav-pill" id="su-tier-pill">Beginner Plan</div>
    <button class="nav-cta" style="background:transparent;border:1px solid var(--border);color:var(--off)" onclick="goBackToResults()">← Back to Plan</button>
  </div>
</nav>
<div class="signup-wrap">
  <div class="signup-left">
    <div class="signup-eyebrow"><span class="signup-eyebrow-line"></span>Your plan is ready</div>
    <h2>CLAIM YOUR<br><span id="su-accent">FREE</span><br>7-DAY TRIAL</h2>
    <p class="signup-tagline">You built a personalized plan. Don't lose it — start your free trial and get full access to your program, AI coach, macro tracker, and progress dashboard.</p>
    <div class="plan-summary">
      <div class="ps-header"><div class="ps-label">Your Generated Plan</div><div class="ps-tier-badge" id="su-tier-badge">Beginner</div></div>
      <div class="ps-plan-name" id="su-plan-name">—</div>
      <div class="ps-tagline" id="su-plan-tagline">—</div>
      <div class="ps-stats">
        <div class="ps-stat"><div class="ps-stat-val" id="su-cal">—</div><div class="ps-stat-label">Daily Calories</div></div>
        <div class="ps-stat"><div class="ps-stat-val" id="su-pro">—</div><div class="ps-stat-label">Daily Protein</div></div>
        <div class="ps-stat"><div class="ps-stat-val" id="su-days">—</div><div class="ps-stat-label">Gym Days/Week</div></div>
        <div class="ps-stat"><div class="ps-stat-val" id="su-timeline">—</div><div class="ps-stat-label">Your Timeline</div></div>
      </div>
    </div>
    <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--dim);margin-bottom:12px">What's included</div>
    <div class="included-list">
      <div class="included-item"><div class="included-check">✓</div>Your personalized program saved to your dashboard</div>
      <div class="included-item"><div class="included-check">✓</div>Exercise-by-exercise workout tracking with exercise guides</div>
      <div class="included-item"><div class="included-check">✓</div>Macro tracker with calorie countdown</div>
      <div class="included-item"><div class="included-check">✓</div>Progress tracking with previous week comparison</div>
      <div class="included-item"><div class="included-check">✓</div>Cancel anytime — no questions asked</div>
    </div>
  </div>
  <div class="signup-card">
    <div class="trial-badge">★ 7 DAYS FREE — NO CHARGE TODAY</div>
    <div class="signup-form-title">CREATE YOUR ACCOUNT</div>
    <div class="signup-form-sub">$29.99/month after trial</div>
    <div class="sf-row">
      <div class="sf-group"><div class="sf-label">First Name</div><input class="sf-input" id="su-firstname" type="text" placeholder="Jake"></div>
      <div class="sf-group"><div class="sf-label">Last Name</div><input class="sf-input" id="su-lastname" type="text" placeholder="Davis"></div>
    </div>
    <div class="sf-group"><div class="sf-label">Email</div><input class="sf-input" id="su-email" type="email" placeholder="you@email.com"></div>
    <div class="sf-group">
      <div class="sf-label">Password</div>
      <input class="sf-input" id="su-password" type="password" placeholder="Min. 8 characters" oninput="checkPwStrength(this.value)">
      <div class="pw-strength"><div class="pw-bar" id="pw1"></div><div class="pw-bar" id="pw2"></div><div class="pw-bar" id="pw3"></div><div class="pw-bar" id="pw4"></div></div>
    </div>
    <div class="trial-breakdown">
      <div class="tb-row"><div class="tb-label">Today</div><div class="tb-val free">$0.00 FREE</div></div>
      <div class="tb-row"><div class="tb-label">Days 1–7</div><div class="tb-val">Full access, no charge</div></div>
      <div class="tb-row"><div class="tb-label">Day 8 onward</div><div class="tb-val after">$29.99/month — cancel anytime</div></div>
    </div>
    <button class="btn-start-trial" id="su-submit-btn" onclick="submitSignup()">START FREE TRIAL →</button>
    <div class="signup-fine">No credit card required · Cancel before day 7 to pay nothing · $29.99/month after</div>
    <div class="signup-login">Already have an account? <a onclick="goToDash()">Sign in</a></div>
  </div>
</div>
</div><!-- /screen-signup -->


<!-- ══════════ DASHBOARD ══════════ -->
<div id="screen-dash" class="screen">
<nav>
  <div class="logo">FIT<span class="logo-dot">●</span>START</div>
  <div class="nav-right">
    <div class="streak-pill"><svg viewBox="0 0 24 24" fill="currentColor" width="13" height="13" style="flex-shrink:0"><path d="M12 2c0 0-4 4.5-4 9a4 4 0 0 0 8 0c0-4.5-4-9-4-9zm0 11a2 2 0 0 1-2-2c0-2 2-5 2-5s2 3 2 5a2 2 0 0 1-2 2z"/></svg> <span id="dash-streak">1</span>-day streak</div>
    <div class="user-pill"><div class="avatar" id="dash-avatar">?</div><span id="dash-username">You</span></div>
  </div>
</nav>
<div class="shell">
  <div class="sidebar-nav">
    <div class="sb-label">Dashboard</div>
    <button class="sb-btn active" onclick="dashNav('today',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></span>Today</button>
    <button class="sb-btn" onclick="dashNav('week',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>This Week<span class="sb-badge" id="week-badge">Wk 1</span></button>
    <button class="sb-btn" onclick="dashNav('nutrition',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><path d="M12 2a5 5 0 0 1 5 5c0 4-5 11-5 11S7 11 7 7a5 5 0 0 1 5-5z"/><circle cx="12" cy="7" r="2"/></svg></span>Nutrition</button>
    <button class="sb-btn" onclick="dashNav('progress',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></span>Progress</button>
    <button class="sb-btn" onclick="dashNav('coach',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></span>AI Coach</button>
    <div class="sb-label" style="margin-top:12px">Plan</div>
    <button class="sb-btn" onclick="dashNav('program',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><path d="M6 4v6M6 14v6M18 4v6M18 14v6M3 7h6M15 7h6M3 17h6M15 17h6"/></svg></span>My Program</button>
    <button class="sb-btn" onclick="dashNav('myplan',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></span>My Plan</button>
    <button class="sb-btn" onclick="dashNav('settings',this)"><span class="sb-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="15" height="15"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33H15a1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15H4.5a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68V4.5a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51v.18a1.65 1.65 0 0 0 1.82.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9v.18a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span>Settings</button>
  </div>
  <div class="main-content">

    <!-- TODAY -->
    <div class="view active" id="view-today">
      <div class="page-header">
        <div class="page-title" id="dash-day-title">TODAY</div>
        <div class="page-sub" id="dash-day-sub">Week 1 of your program</div>
      </div>
      <div class="today-grid">
        <div class="stat-card"><div class="card-label">Calories</div><div class="sc-val" id="d-cal">0</div><div class="sc-sub" id="d-cal-sub">of — target</div><div class="prog-bar"><div class="prog-fill" id="d-cal-bar" style="width:0%"></div></div></div>
        <div class="stat-card"><div class="card-label">Protein</div><div class="sc-val" id="d-pro">0g</div><div class="sc-sub" id="d-pro-sub">of —g target</div><div class="prog-bar"><div class="prog-fill" id="d-pro-bar" style="width:0%"></div></div></div>
        <div class="stat-card"><div class="card-label">Carbs</div><div class="sc-val" id="d-carb">0g</div><div class="sc-sub" id="d-carb-sub">of —g target</div><div class="prog-bar"><div class="prog-fill" id="d-carb-bar" style="width:0%"></div></div></div>
        <div class="stat-card"><div class="card-label">Fat</div><div class="sc-val" id="d-fat">0g</div><div class="sc-sub" id="d-fat-sub">of —g target</div><div class="prog-bar"><div class="prog-fill" id="d-fat-bar" style="width:0%"></div></div></div>
        <div style="display:none" id="d-wkt-name" aria-hidden="true"></div><div style="display:none" id="d-wkt-sub" aria-hidden="true"></div><div style="display:none" id="d-wkt-bar" aria-hidden="true"></div>
      </div>
      <div class="log-toggle-card">
        <div style="display:flex;align-items:center;gap:10px;padding:14px 18px">
          <div style="font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:1px;margin-right:4px">TODAY'S FOOD</div>
          <button class="btn-cat-add" onclick="dashNav('coach')" style="margin-left:auto">Log via AI Coach →</button>
        </div>
        <div id="today-mini-log" style="border-top:1px solid var(--border)"></div>
      </div>
      <div class="workout-card" style="margin-top:16px">
        <div class="wc-header">
          <div>
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
              <div class="wc-badge" id="wc-badge">● Today</div>
              <button id="today-customize-btn" onclick="openCustomWorkoutBuilder()" style="padding:4px 10px;background:none;border:1px solid var(--border2);border-radius:6px;color:var(--dim);font-family:'Bebas Neue',sans-serif;font-size:0.62rem;letter-spacing:1.2px;cursor:pointer;display:flex;align-items:center;gap:4px;transition:all 0.15s" onmouseover="this.style.color='var(--white)';this.style.borderColor='var(--border)'" onmouseout="this.style.color='var(--dim)';this.style.borderColor='var(--border2)'">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="10" height="10"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
                CUSTOM
              </button>
            </div>
            <div class="wc-name" id="wc-name">YOUR WORKOUT</div>
          </div>
          <button class="btn-primary" id="today-start-btn" onclick="openWorkoutEnv(TODAY_IDX)">START WORKOUT</button>
        </div>
        <div class="ex-list" id="today-ex-list"></div>
      </div>
    </div>

    <!-- THIS WEEK -->
    <div class="view" id="view-week">
      <div class="page-header"><div class="page-title">THIS WEEK</div><div class="page-sub" id="week-view-sub">Week 1 · Tap any day to log</div></div>
      <div class="week-day-grid" id="week-grid"></div>
      <div class="week-stat-grid">
        <div class="stat-card"><div class="card-label">Workouts Done</div><div class="sc-val" id="wk-done">0</div><div class="sc-sub" id="wk-done-sub">of 0 scheduled</div><div class="prog-bar"><div class="prog-fill" id="wk-done-bar" style="width:0%"></div></div></div>
        <div class="stat-card"><div class="card-label">Avg Calories</div><div class="sc-val">—</div><div class="sc-sub">this week so far</div></div>
        <div class="stat-card"><div class="card-label">Avg Protein</div><div class="sc-val">—</div><div class="sc-sub" id="wk-pro-sub">goal: —g/day</div></div>
      </div>
    </div>

    <!-- NUTRITION -->
    <div class="view" id="view-nutrition">
      <div class="page-header"><div class="page-title">NUTRITION</div><div class="page-sub">Track food, water & macros</div></div>
      <div class="day-picker-nav" id="day-picker-nav"></div>

      <!-- MACRO BARS -->
      <div class="macro-bar" style="margin-bottom:14px">
        <div class="mb-item"><div class="mb-label">Calories</div><div class="mb-val" id="n-cal">0</div><div class="mb-target" id="n-cal-tgt">of —</div><div class="mb-bar"><div class="mb-fill" id="n-cal-bar" style="width:0%"></div></div></div>
        <div class="mb-item"><div class="mb-label">Protein</div><div class="mb-val" id="n-pro">0g</div><div class="mb-target" id="n-pro-tgt">of —g</div><div class="mb-bar"><div class="mb-fill" id="n-pro-bar" style="width:0%"></div></div></div>
        <div class="mb-item"><div class="mb-label">Carbs</div><div class="mb-val" id="n-carb">0g</div><div class="mb-target" id="n-carb-tgt">of —g</div><div class="mb-bar"><div class="mb-fill" id="n-carb-bar" style="width:0%"></div></div></div>
        <div class="mb-item"><div class="mb-label">Fat</div><div class="mb-val" id="n-fat">0g</div><div class="mb-target" id="n-fat-tgt">of —g</div><div class="mb-bar"><div class="mb-fill" id="n-fat-bar" style="width:0%"></div></div></div>
      </div>

      <!-- WATER TRACKER -->
      <div class="water-section">
        <div class="water-header">
          <div class="water-title">WATER INTAKE</div>
          <div style="display:flex;align-items:center;gap:8px">
            <span style="font-size:0.85rem;color:var(--off);font-weight:600">Goal:</span>
            <input type="number" id="water-goal-input" value="64" min="16" max="300"
              style="width:60px;padding:5px 8px;background:var(--dark);border:1px solid var(--border2);border-radius:7px;font-family:'Inter',sans-serif;font-size:0.85rem;color:var(--green);font-weight:700;outline:none;text-align:center"
              onchange="updateWaterGoal(this.value)">
            <span style="font-size:0.85rem;color:var(--off);font-weight:600">oz / day</span>
          </div>
        </div>
        <div class="water-ring-wrap">
          <div class="water-ring">
            <svg width="100" height="100" viewBox="0 0 100 100">
              <circle class="water-ring-track" cx="50" cy="50" r="42"/>
              <circle class="water-ring-fill" id="water-ring-fill" cx="50" cy="50" r="42"
                stroke-dasharray="263.9" stroke-dashoffset="263.9"/>
            </svg>
            <div class="water-ring-text">
              <div class="water-oz" id="water-oz-display">0</div>
              <div class="water-oz-label">oz</div>
            </div>
          </div>
          <div style="flex:1">
            <div style="font-size:0.85rem;color:var(--off);margin-bottom:10px" id="water-status">Stay hydrated <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M6 4v6M6 14v6M18 4v6M18 14v6M3 7h6M15 7h6M3 17h6M15 17h6"/></svg></div>
            <div class="water-btns" style="flex-wrap:wrap;gap:8px">
              <button class="water-add-btn" onclick="addWater(8)">+8 oz</button>
              <button class="water-add-btn" onclick="addWater(16)">+16 oz</button>
              <button class="water-add-btn" onclick="addWater(32)">+32 oz</button>
              <button class="water-add-btn" onclick="toggleCustomWater()" id="water-custom-toggle" style="white-space:nowrap">+ Add</button>
            </div>
            <div id="water-custom-row" style="display:none;margin-top:10px;display:none;align-items:center;gap:8px">
              <input type="number" id="water-custom-input" placeholder="oz" min="1" max="200"
                style="width:72px;padding:7px 10px;background:var(--dark);border:1px solid rgba(56,189,248,0.3);border-radius:8px;font-family:'Syne',sans-serif;font-size:0.88rem;color:var(--white);outline:none;"
                onkeydown="if(event.key==='Enter')addCustomWater()">
              <button class="water-add-btn" onclick="addCustomWater()" style="white-space:nowrap;background:rgba(56,189,248,0.18)">LOG</button>
              <button onclick="toggleCustomWater()" style="background:none;border:none;color:var(--dim);cursor:pointer;font-size:0.85rem;padding:4px 6px">✕</button>
            </div>
          </div>
        </div>
        <div class="water-cups" id="water-cups"></div>
      </div>

      <!-- MEAL CATEGORIES (MFP-style) -->
      <div id="meal-categories"></div>
    </div>

    <!-- PROGRESS -->
    <div class="view" id="view-progress">
      <div class="page-header"><div class="page-title">PROGRESS</div><div class="page-sub">Your stats over time</div></div>

      <!-- STAT STRIP -->
      <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:14px">
        <div class="prog-card" style="padding:14px;text-align:center">
          <div class="sbox-val" id="stat-streak">0</div><div class="sbox-label">Streak</div>
        </div>
        <div class="prog-card" style="padding:14px;text-align:center">
          <div class="sbox-val" id="stat-workouts">0</div><div class="sbox-label">This Month</div>
        </div>
        <div class="prog-card" style="padding:14px;text-align:center">
          <div class="sbox-val" id="stat-lbs-lost" style="font-size:1.2rem">—</div><div class="sbox-label" id="stat-lbs-label">Lbs Lost</div>
        </div>
        <div class="prog-card" style="padding:14px;text-align:center">
          <div class="sbox-val" id="stat-avg-pro">—</div><div class="sbox-label">Avg Protein</div>
        </div>
      </div>

      <!-- WEIGHT CHART -->
      <div class="prog-card" style="margin-bottom:14px">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px">
          <div class="pc-title">BODY WEIGHT</div>
          <div style="display:flex;align-items:center;gap:8px">
            <input type="number" id="weight-log-input" placeholder="lbs" step="0.1" min="50" max="600"
              style="width:80px;padding:8px 10px;background:var(--dark);border:1px solid var(--border2);border-radius:8px;font-size:0.95rem;color:var(--white);outline:none;text-align:center"
              onkeydown="if(event.key==='Enter')logBodyWeight()">
            <button onclick="logBodyWeight()" style="padding:8px 14px;background:var(--green);border:none;border-radius:8px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:1px;cursor:pointer">LOG</button>
          </div>
        </div>
        <div id="weight-current-display" style="font-size:0.82rem;color:var(--off);margin-bottom:12px"></div>
        <div id="weight-chart-wrap" style="width:100%;height:160px;position:relative">
          <div id="weight-chart-empty" style="height:160px;display:flex;align-items:center;justify-content:center;color:var(--dim);font-size:0.82rem">Log your weight to see your trend</div>
          <svg id="weight-chart-svg" style="display:none;width:100%;height:160px" viewBox="0 0 400 160" preserveAspectRatio="none"></svg>
        </div>
        <div id="weight-history-list" style="margin-top:10px;display:flex;flex-direction:column;gap:4px;max-height:160px;overflow-y:auto"></div>
      </div>

      <!-- WORKOUT STREAK CALENDAR -->
      <div class="prog-card" style="margin-bottom:14px">
        <div class="pc-title" style="margin-bottom:12px">WORKOUT HISTORY — <span id="streak-month-label" style="color:var(--green)"></span></div>
        <div class="streak-cal" id="streak-cal"></div>
      </div>

      <!-- WORKOUT FREQUENCY CHART -->
      <div class="prog-card" style="margin-bottom:14px">
        <div class="pc-title" style="margin-bottom:14px">WORKOUTS PER WEEK (last 8 weeks)</div>
        <div id="freq-chart-wrap" style="width:100%;height:100px">
          <svg id="freq-chart-svg" width="100%" height="100" viewBox="0 0 400 100" preserveAspectRatio="none"></svg>
        </div>
      </div>

    </div>

    <!-- MY PROGRAM -->
    <div class="view" id="view-program">
      <div class="page-header"><div class="page-title">MY PROGRAM</div><div class="page-sub" id="prog-sub">Your personalized plan</div></div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-bottom:20px">
        <div class="stat-card"><div class="card-label">Plan</div><div class="sc-val" style="font-size:1.1rem;line-height:1.4" id="prog-tier-val">—</div><div class="sc-sub" id="prog-plan-name">—</div></div>
        <div class="stat-card"><div class="card-label">Progress</div><div class="sc-val" id="prog-fraction">1 / —</div><div class="sc-sub">weeks completed</div><div class="prog-bar"><div class="prog-fill" id="prog-pct-bar" style="width:4%"></div></div></div>
        <div class="stat-card"><div class="card-label">Gym Days</div><div class="sc-val" style="font-size:0.95rem;line-height:1.5" id="prog-gym-days">—</div><div class="sc-sub" id="prog-days-count">— days/week</div></div>
      </div>
      <div id="week-accordion" style="display:flex;flex-direction:column;gap:10px"></div>
    </div>

    <!-- MY PLAN -->
    <div class="view" id="view-myplan">
      <div class="page-header"><div class="page-title">MY PLAN</div><div class="page-sub" id="myplan-sub">Your personalized fitness blueprint</div></div>
      <div id="myplan-banner" style="margin-bottom:14px"></div>
      <div id="myplan-body"></div>
    </div>

    <!-- SETTINGS -->
    <div class="view" id="view-settings">
      <div class="page-header"><div class="page-title">SETTINGS</div><div class="page-sub">Manage your plan, targets, and account</div></div>
      <div style="display:flex;flex-direction:column;gap:14px;max-width:680px">
        <div class="card">
          <div class="card-label" style="margin-bottom:16px">Profile</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px" class="settings-grid">
            <div><div style="font-size:0.65rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--dim);margin-bottom:6px">Name</div><input id="s-name" class="settings-input"></div>
            <div><div style="font-size:0.65rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--dim);margin-bottom:6px">Current Weight</div><input id="s-weight" class="settings-input"></div>
            <div><div style="font-size:0.65rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--dim);margin-bottom:6px">Goal Weight</div><input id="s-goal" class="settings-input"></div>
            <div><div style="font-size:0.65rem;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:var(--dim);margin-bottom:6px">Experience Level</div><input id="s-tier" class="settings-input" readonly></div>
          </div>
        </div>
        <div class="card">
          <div class="card-label" style="margin-bottom:16px">Daily Macro Targets</div>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px">
            <div><div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--off);margin-bottom:6px;text-align:center">Calories</div><input id="s-cal" type="number" style="width:100%;padding:10px 6px;background:var(--dark);border:1px solid var(--border);border-radius:9px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--white);text-align:center;letter-spacing:1px;outline:none"></div>
            <div><div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--green);margin-bottom:6px;text-align:center">Protein g</div><input id="s-pro" type="number" style="width:100%;padding:10px 6px;background:var(--dark);border:1px solid var(--border);border-radius:9px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--green);text-align:center;letter-spacing:1px;outline:none"></div>
            <div><div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--blue);margin-bottom:6px;text-align:center">Carbs g</div><input id="s-carb" type="number" style="width:100%;padding:10px 6px;background:var(--dark);border:1px solid var(--border);border-radius:9px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--blue);text-align:center;letter-spacing:1px;outline:none"></div>
            <div><div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--orange);margin-bottom:6px;text-align:center">Fat g</div><input id="s-fat" type="number" style="width:100%;padding:10px 6px;background:var(--dark);border:1px solid var(--border);border-radius:9px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--orange);text-align:center;letter-spacing:1px;outline:none"></div>
          </div>
        </div>
        <div class="card"><div class="card-label" style="margin-bottom:16px">Gym Days</div><div style="display:flex;gap:8px;flex-wrap:wrap" id="settings-gym-days"></div></div>
        <div class="card" style="border-color:rgba(251,146,60,0.2)">
          <div class="card-label" style="margin-bottom:12px">Subscription</div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><div style="font-size:0.95rem;font-weight:600;margin-bottom:3px">FitStart Pro &nbsp;<span style="color:var(--orange);font-size:0.75rem;font-weight:700">● ACTIVE</span></div><div style="font-family:'DM Mono',monospace;font-size:0.72rem;color:var(--dim)">$29.99/month · Cancel anytime</div></div>
            <button style="padding:9px 18px;border:1px solid var(--border);border-radius:9px;background:none;color:var(--dim);font-family:'Syne',sans-serif;font-size:0.78rem;cursor:pointer">Manage</button>
          </div>
        </div>
        <button id="save-btn" onclick="saveSettings()" style="padding:14px;background:var(--green);color:var(--black);border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer">SAVE CHANGES</button>
      </div>
    </div>

    <!-- AI COACH -->
    <div class="view" id="view-coach">
      <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px 8px">
        <div><span style="font-family:'Bebas Neue',sans-serif;font-size:1.15rem;letter-spacing:1.5px;color:var(--white)">AI COACH</span></div>
        <button id="coach-clear-btn" onclick="clearCoachHistory()" style="display:none;padding:5px 12px;background:none;border:1px solid var(--border);border-radius:7px;color:var(--dim);font-family:'DM Mono',monospace;font-size:0.65rem;cursor:pointer;letter-spacing:0.5px">Clear</button>
      </div>
      <div id="coach-chat-container" class="coach-chat-container">
        <div id="coach-messages" class="coach-messages">
          <div id="coach-starters" class="coach-starters">
            <div class="coach-welcome">
              <div class="coach-welcome-icon"><svg viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="1.5" width="32" height="32"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
              <div class="coach-welcome-title">WHAT CAN I HELP WITH?</div>
              <div class="coach-welcome-sub">Ask me anything about training, nutrition, or recovery</div>
            </div>
            <div class="coach-starter-grid">
              <button class="coach-starter-btn" onclick="sendCoachStarter(this.textContent)">I had 2 eggs and toast for breakfast</button>
              <button class="coach-starter-btn" onclick="sendCoachStarter(this.textContent)">What should I eat to hit my protein today?</button>
              <button class="coach-starter-btn" onclick="sendCoachStarter(this.textContent)">Is my split good for hypertrophy?</button>
              <button class="coach-starter-btn" onclick="sendCoachStarter(this.textContent)">I missed 3 days — how do I get back on track?</button>
            </div>
          </div>
        </div>
        <div class="coach-input-bar">
          <input type="text" id="coach-input" class="coach-text-input" placeholder="Ask your coach..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendCoachMessage();}">
          <button class="coach-send-btn" id="coach-send-btn" onclick="sendCoachMessage()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
          </button>
        </div>
      </div>
    </div>

  </div>
</div><!-- end shell -->

  <!-- Mobile Bottom Tab Bar (fixed, outside shell) -->
  <nav class="mobile-tab-bar" id="mobile-tab-bar">
    <button class="mob-tab active" id="mob-tab-today" onclick="dashNav('today',this);syncMobTab('today')">
      <svg class="mob-tab-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      <span class="mob-tab-label">Today</span>
    </button>
    <button class="mob-tab" id="mob-tab-week" onclick="dashNav('week',this);syncMobTab('week')">
      <svg class="mob-tab-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      <span class="mob-tab-label">Week</span>
    </button>
    <button class="mob-tab" id="mob-tab-nutrition" onclick="dashNav('nutrition',this);syncMobTab('nutrition')">
      <svg class="mob-tab-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3zm0 0v7"/></svg>
      <span class="mob-tab-label">Nutrition</span>
    </button>
    <button class="mob-tab" id="mob-tab-coach" onclick="dashNav('coach',this);syncMobTab('coach')">
      <svg class="mob-tab-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
      <span class="mob-tab-label">Coach</span>
    </button>
    <button class="mob-tab" id="mob-tab-more" onclick="toggleMobMore()">
      <svg class="mob-tab-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
      <span class="mob-tab-label">More</span>
    </button>
  </nav>

  <!-- Mobile More Drawer -->
  <div class="mob-more-drawer" id="mob-more-drawer">
    <div class="mob-more-handle"></div>
    <div class="mob-more-item" onclick="mobNavTo('progress');closeMobMore()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
      Progress
    </div>
    <div class="mob-more-item" onclick="mobNavTo('program');closeMobMore()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M18 20V10M12 20V4M6 20v-6"/></svg>
      My Program
    </div>
    <div class="mob-more-item" onclick="mobNavTo('myplan');closeMobMore()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
      My Plan
    </div>
    <div class="mob-more-item" onclick="mobNavTo('settings');closeMobMore()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      Settings
    </div>
  </div>
</div><!-- /screen-dash -->


<!-- ══════════ WORKOUT ENVIRONMENT ══════════ -->
<div id="screen-workout" class="screen">
  <div class="wo-header" style="gap:20px">
    <button class="wo-back" onclick="exitWorkout()">← Exit Workout</button>
    <div class="wo-title" id="wo-title" style="font-size:1.1rem;letter-spacing:1px">WORKOUT</div>
    <button id="wo-customize-btn" style="display:none;align-items:center;gap:5px;background:none;border:1px solid var(--border);border-radius:8px;padding:5px 10px;color:var(--dim);font-family:'Bebas Neue',sans-serif;font-size:0.72rem;letter-spacing:1px;cursor:pointer;flex-shrink:0" title="Switch to custom or AI workout">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="13" height="13"><path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
      CUSTOMIZE
    </button>
    <div class="wo-progress-wrap" style="flex:1">
      <div class="wo-progress-bar"><div class="wo-progress-fill" id="wo-prog-fill" style="width:0%"></div></div>
      <div class="wo-progress-label" id="wo-prog-label">0 / 0</div>
    </div>

  </div>
  <!-- REST TIMER BAR -->
  <div id="rest-timer-bar" style="display:flex;align-items:center;gap:0;background:#0d0d0d;border-bottom:1px solid var(--border);flex-shrink:0;height:56px">
    <button onclick="adjustRest(-15)" style="width:56px;height:56px;border:none;border-right:1px solid var(--border);background:none;color:var(--white);font-size:1.6rem;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center">−</button>
    <div style="flex:1;position:relative;overflow:hidden;height:56px;cursor:pointer" onclick="toggleRestTimer()">
      <div id="rest-timer-progress" style="position:absolute;top:0;left:0;height:100%;background:rgba(251,146,60,0.2);width:0%;pointer-events:none;transition:none"></div>
      <div style="position:relative;z-index:1;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:2px">
        <span id="rest-timer-label" style="font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--white)">START REST</span>
        <span id="rest-timer-secs-display" style="font-family:'DM Mono',monospace;font-size:0.8rem;color:var(--orange)">3:00</span>
      </div>
    </div>
    <button onclick="adjustRest(15)" style="width:56px;height:56px;border:none;border-left:1px solid var(--border);background:none;color:var(--white);font-size:1.6rem;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center">+</button>
  </div>
  <div class="wo-body">
    <!-- LEFT: Exercise List -->
    <div class="wo-left-panel">
      <div class="wo-left-header">
        <div class="wo-left-title" id="wo-day-title">TODAY</div>
        <div class="wo-left-sub" id="wo-day-subtitle"></div>
      </div>
      <div class="wo-ex-sidebar" id="wo-ex-list"></div>
      <div style="padding:12px">
        <button class="btn-add-ex" style="width:100%;justify-content:center" onclick="openAddExModal()">+ ADD EXERCISE</button>
      </div>
    </div>

    <!-- CENTER: Demo + Sets -->
    <div class="wo-main elite" id="wo-main">
      <!-- Exercise Header -->
      <div class="wo-ex-header">
        <div>
          <div class="ex-video-title" id="wo-ex-title">Select an exercise</div>
          <div class="ex-muscles-tag" id="wo-muscles-tag" style="margin-top:4px">Muscles targeted</div>
        </div>
        <div class="ex-video-badge" id="wo-ex-badge"></div>
      </div>
      <div id="wo-phase-badge" style="display:none"></div>

      <!-- Form Demo Images -->
      <div class="ex-demo-wrap" id="wo-demo-wrap">
        <div class="ex-demo-frames" id="wo-demo-frames">
          <div class="demo-frame"><div class="demo-frame-img-placeholder"><div class="demo-frame-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M6 4v6M6 14v6M18 4v6M18 14v6M3 7h6M15 7h6M3 17h6M15 17h6"/></svg></div></div><div class="demo-frame-label">START</div></div>
          <div class="demo-frame"><div class="demo-frame-img-placeholder"><div class="demo-frame-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M6 4v6M6 14v6M18 4v6M18 14v6M3 7h6M15 7h6M3 17h6M15 17h6"/></svg></div></div><div class="demo-frame-label">MID</div></div>
          <div class="demo-frame"><div class="demo-frame-img-placeholder"><div class="demo-frame-icon" style="font-size:1.5rem;opacity:0.5">✓</div></div><div class="demo-frame-label">END</div></div>
        </div>
      </div>

      <!-- Sets Logger -->
      <div class="sets-panel">
        <div class="sets-header">
          <div class="sets-title">TRACK YOUR SETS</div>
          <div style="display:flex;gap:8px;align-items:center">
            <button onclick="addSet()" style="padding:6px 12px;background:var(--green-dim);border:1px solid rgba(74,222,128,0.2);border-radius:7px;color:var(--green);font-family:'Bebas Neue',sans-serif;font-size:0.8rem;letter-spacing:1px;cursor:pointer">+ SET</button>
            <span id="rest-timer-display" style="display:none;color:var(--orange);font-weight:700;font-size:0.9rem"></span>
          </div>
        </div>

        <table class="sets-table">
          <colgroup>
            <col style="width:55px">
            <col style="width:90px">
            <col style="width:75px">
            <col style="width:44px">
            <col style="width:36px">
          </colgroup>
          <thead><tr><th>Set</th><th>Weight</th><th>Reps</th><th>✓</th><th></th></tr></thead>
          <tbody id="sets-tbody"></tbody>
        </table>
      </div>

    </div>
  </div>
  <!-- Nav buttons OUTSIDE scroll area so they're always tappable -->
  <div class="wo-nav-btns">
    <button class="btn-prev-ex hidden" id="wo-prev-btn">← BACK</button>
    <button class="btn-next-ex" id="wo-next-btn">DONE →</button>
  </div>

</div>

<!-- Unplanned Workout Modal -->
<div id="unplanned-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.92);z-index:6000;align-items:flex-end;justify-content:center">
  <div id="unplanned-modal-inner" style="background:var(--dark);border:1px solid var(--border2);border-radius:24px 24px 0 0;width:100%;max-width:600px;padding:24px 20px 40px;max-height:92dvh;overflow-y:auto;transition:max-height 0.3s ease">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:1.5px" id="unplanned-modal-title">START A WORKOUT</div>
      <button onclick="closeUnplannedModal()" style="background:none;border:none;color:var(--dim);font-size:1.4rem;cursor:pointer;padding:4px 8px">✕</button>
    </div>
    <div style="font-size:0.82rem;color:var(--dim);margin-bottom:24px" id="unplanned-modal-day"></div>

    <!-- Main options -->
    <div id="unplanned-options">
      <div onclick="startAIWorkout()" style="background:var(--green-dim);border:1px solid rgba(74,222,128,0.3);border-radius:16px;padding:20px 22px;margin-bottom:12px;cursor:pointer;transition:opacity 0.15s" onmousedown="this.style.opacity=0.7" onmouseup="this.style.opacity=1">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.15rem;letter-spacing:1.5px;color:var(--green)">AI-GENERATED WORKOUT</div>
        <div style="font-size:0.78rem;color:var(--off);margin-top:4px">A smart workout built for your fitness level and goals</div>
      </div>
      <div onclick="showCustomBuilder()" style="background:var(--card);border:1px solid var(--border2);border-radius:16px;padding:20px 22px;cursor:pointer;transition:opacity 0.15s" onmousedown="this.style.opacity=0.7" onmouseup="this.style.opacity=1">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.15rem;letter-spacing:1.5px;color:var(--white)">BUILD CUSTOM WORKOUT</div>
        <div style="font-size:0.78rem;color:var(--dim);margin-top:4px">Choose exercises from the library and set your own sets, reps & rest</div>
      </div>
    </div>

    <!-- AI: Generating spinner -->
    <div id="ai-workout-loading" style="display:none;text-align:center;padding:40px 0">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--green);margin-bottom:8px">GENERATING YOUR WORKOUT</div>
      <div style="font-size:0.8rem;color:var(--dim)">Personalised to your level and goals...</div>
    </div>

    <!-- AI: Workout preview (shown before starting) -->
    <div id="ai-workout-preview" style="display:none">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:1px;color:var(--dim);margin-bottom:14px" id="ai-preview-label"></div>
      <div id="ai-debug-status" style="display:none;font-family:'DM Mono',monospace;font-size:0.7rem;color:var(--orange);background:rgba(251,146,60,0.1);border:1px solid rgba(251,146,60,0.2);border-radius:8px;padding:8px 12px;margin-bottom:12px;word-break:break-all;max-height:80px;overflow-y:auto"></div>
      <div id="ai-preview-list" style="display:flex;flex-direction:column;gap:8px;margin-bottom:20px"></div>
      <button onclick="launchAIWorkout()" style="width:100%;padding:16px;background:var(--green);border:none;border-radius:12px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:1.15rem;letter-spacing:2px;cursor:pointer">BEGIN WORKOUT →</button>
      <button onclick="regenerateAIWorkout()" style="width:100%;padding:12px;background:none;border:1px solid var(--border);border-radius:12px;color:var(--dim);font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:1px;cursor:pointer;margin-top:8px">↺ GENERATE ANOTHER</button>
    </div>

    <!-- Custom builder -->
    <div id="custom-builder" style="display:none;margin-top:4px">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:1px;margin-bottom:10px;color:var(--off)">SELECT EXERCISES</div>
      <input id="custom-ex-search" type="text" placeholder="Search exercises..." oninput="renderCustomExList()"
        style="width:100%;box-sizing:border-box;padding:11px 14px;background:var(--card);border:1px solid var(--border2);border-radius:10px;color:var(--white);font-size:0.88rem;outline:none;margin-bottom:10px">
      <div style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:10px" id="custom-cat-filters"></div>
      <div id="custom-ex-list" style="max-height:45dvh;overflow-y:auto;display:flex;flex-direction:column;gap:5px"></div>
      <div id="custom-selected" style="margin-top:16px;display:none">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:1px;color:var(--green);margin-bottom:10px">SELECTED — CONFIGURE SETS</div>
        <div id="custom-selected-list" style="display:flex;flex-direction:column;gap:8px;margin-bottom:14px"></div>
        <button onclick="launchCustomWorkout()" style="width:100%;padding:16px;background:var(--green);border:none;border-radius:12px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer">BEGIN WORKOUT →</button>
      </div>
    </div>
  </div>
</div>

<!-- Food Search Modal -->
<!-- Barcode Modal -->
<div id="barcode-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:9999;flex-direction:column">
  <div style="display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--border)">
    <div style="font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:1px">SCAN BARCODE</div>
    <button onclick="closeBarcodeModal()" style="background:none;border:none;color:var(--off);font-size:1.4rem;cursor:pointer">&#10005;</button>
  </div>
  <div style="padding:20px;border-bottom:1px solid var(--border)">
    <div style="font-size:0.78rem;color:var(--dim);margin-bottom:10px;text-align:center">Enter the barcode number from the package</div>
    <div style="display:flex;gap:10px">
      <input id="barcode-input" type="number" inputmode="numeric" placeholder="e.g. 049000042566"
        style="flex:1;padding:14px 16px;background:var(--card);border:1px solid var(--border2);border-radius:10px;font-family:'DM Mono',monospace;font-size:1.1rem;color:var(--white);outline:none;text-align:center;letter-spacing:1px"
        onkeydown="if(event.key==='Enter')submitBarcode()">
      <button onclick="submitBarcode()"
        style="padding:14px 24px;background:var(--green);border:none;border-radius:10px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:1.5px;cursor:pointer;font-weight:700;white-space:nowrap">LOOK UP</button>
    </div>
    <div id="barcode-lookup-status" style="font-size:0.72rem;margin-top:8px;color:var(--dim);text-align:center"></div>
  </div>
  <div style="flex:1;position:relative;overflow:hidden;background:#000">
    <video id="barcode-video" autoplay playsinline muted style="width:100%;height:100%;object-fit:cover"></video>
    <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none">
      <div style="width:260px;height:140px;border:2px solid var(--green);border-radius:10px;box-shadow:0 0 0 9999px rgba(0,0,0,0.55)"></div>
    </div>
    <div id="barcode-scan-status" style="position:absolute;bottom:16px;left:0;right:0;text-align:center;font-size:0.78rem;color:var(--off)"></div>
  </div>
  <div style="padding:12px 20px;border-top:1px solid var(--border);text-align:center">
    <button onclick="closeBarcodeModal()"
      style="padding:12px 32px;background:var(--card);border:1px solid var(--border);border-radius:10px;color:var(--off);font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:1px;cursor:pointer">CANCEL</button>
  </div>
</div>

<div class="food-modal" id="food-modal">
  <div class="food-modal-header">
    <button class="food-modal-close" onclick="closeFoodModal()">✕</button>
    <div class="food-modal-title">ADD TO <span id="food-modal-cat-label">BREAKFAST</span></div>
  </div>
  <div class="food-modal-search-row">
    <input type="text" class="food-modal-input" id="food-modal-search-input"
      placeholder="Search 500k+ foods..."
      onkeydown="if(event.key==='Enter')searchFoodModal()">
    <button class="btn-food-modal-scan" onclick="openBarcodeScanner(activeFoodCat)" title="Scan barcode"><svg viewBox="0 0 32 20" width="18" height="12" fill="currentColor"><rect x="0" y="0" width="2" height="20"/><rect x="4" y="0" width="1" height="20"/><rect x="7" y="0" width="3" height="20"/><rect x="12" y="0" width="1" height="20"/><rect x="15" y="0" width="2" height="20"/><rect x="19" y="0" width="1" height="20"/><rect x="22" y="0" width="3" height="20"/><rect x="27" y="0" width="1" height="20"/><rect x="30" y="0" width="2" height="20"/></svg></button>
    <button class="btn-food-modal-search" onclick="searchFoodModal()">SEARCH</button>
  </div>
  <div class="food-modal-tabs">
    <div class="fmt-tab active" data-tab="search" onclick="showFoodModalTab('search')">Search</div>
    <div class="fmt-tab" data-tab="recent" onclick="showFoodModalTab('recent')">Recent</div>
    <div class="fmt-tab" data-tab="custom" onclick="showFoodModalTab('custom')">My Foods</div>
  </div>
  <div class="food-modal-results" id="food-modal-results">
    <div class="food-modal-empty">Search above or scan a barcode to find foods</div>
  </div>
</div>

<!-- Manual Food Entry Modal -->
<div class="serving-modal" id="manual-food-modal">
  <div class="serving-card" style="max-width:420px">
    <div class="serving-food-name">CREATE CUSTOM FOOD</div>
    <div style="font-size:0.75rem;color:var(--dim);margin-bottom:16px">Saved to "My Foods" for future use</div>
    <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px">
      <input id="mf-name" placeholder="Food name *" style="padding:10px 12px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Syne',sans-serif;font-size:0.85rem;color:var(--white);outline:none;">
      <input id="mf-serving" placeholder="Serving size (e.g. 1 cup, 100g)" style="padding:10px 12px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Syne',sans-serif;font-size:0.85rem;color:var(--white);outline:none;">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div><div style="font-size:0.65rem;color:var(--green);font-weight:700;margin-bottom:4px">CALORIES</div><input id="mf-cal" type="number" placeholder="0" style="width:100%;padding:9px 10px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Syne',sans-serif;font-size:0.85rem;color:var(--white);outline:none;box-sizing:border-box"></div>
        <div><div style="font-size:0.65rem;color:#60a5fa;font-weight:700;margin-bottom:4px">PROTEIN (g)</div><input id="mf-pro" type="number" placeholder="0" style="width:100%;padding:9px 10px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Syne',sans-serif;font-size:0.85rem;color:var(--white);outline:none;box-sizing:border-box"></div>
        <div><div style="font-size:0.65rem;color:var(--orange);font-weight:700;margin-bottom:4px">CARBS (g)</div><input id="mf-carb" type="number" placeholder="0" style="width:100%;padding:9px 10px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Syne',sans-serif;font-size:0.85rem;color:var(--white);outline:none;box-sizing:border-box"></div>
        <div><div style="font-size:0.65rem;color:#f472b6;font-weight:700;margin-bottom:4px">FAT (g)</div><input id="mf-fat" type="number" placeholder="0" style="width:100%;padding:9px 10px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Syne',sans-serif;font-size:0.85rem;color:var(--white);outline:none;box-sizing:border-box"></div>
      </div>
    </div>
    <div class="serving-actions">
      <button class="btn-cancel-serving" onclick="closeManualFoodModal()">Cancel</button>
      <button class="btn-confirm-log" onclick="saveManualFood()">SAVE & LOG</button>
    </div>
  </div>
</div>

<!-- Serving Size Modal -->
<div class="serving-modal" id="serving-modal">
  <div class="serving-card">
    <div class="serving-food-name" id="sm-food-name">Food Name</div>
    <div style="font-size:0.78rem;color:var(--dim);margin-bottom:12px" id="sm-food-brand"></div>
    
    <!-- Quick serving buttons -->
    <div id="sm-quick-servings" style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap"></div>

    <!-- Macro display -->
    <div class="serving-macro-row">
      <div class="sm-chip"><div class="sm-val" id="sm-cal" style="color:var(--green)">0</div><div class="sm-label">Cal</div></div>
      <div class="sm-chip"><div class="sm-val" id="sm-pro" style="color:#60a5fa">0g</div><div class="sm-label">Protein</div></div>
      <div class="sm-chip"><div class="sm-val" id="sm-carb" style="color:var(--orange)">0g</div><div class="sm-label">Carbs</div></div>
      <div class="sm-chip"><div class="sm-val" id="sm-fat" style="color:#f472b6">0g</div><div class="sm-label">Fat</div></div>
    </div>
    <div style="font-size:0.7rem;color:var(--dim);text-align:center;margin-bottom:12px;font-family:'DM Mono',monospace" id="sm-per-note">Values shown for current amount</div>

    <!-- Custom amount -->
    <div style="font-size:0.72rem;color:var(--dim);font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:6px">Custom Amount</div>
    <div class="serving-size-row">
      <input type="number" class="serving-size-input" id="sm-grams" value="100" min="0.1" step="0.1" oninput="updateServingCalc()" style="flex:1">
      <select id="sm-unit" onchange="updateServingCalc()" style="padding:9px 10px;background:var(--card);border:1px solid var(--border);border-radius:9px;font-family:'Inter',sans-serif;font-size:0.82rem;color:var(--white);outline:none;cursor:pointer">
        <option value="g">grams</option>
        <option value="oz">oz</option>
        <option value="ml">ml</option>
        <option value="serving">serving</option>
      </select>
    </div>
    <div class="serving-actions">
      <button class="btn-cancel-serving" onclick="closeServingModal()">Cancel</button>
      <button class="btn-confirm-log" onclick="confirmLogFood()">LOG IT</button>
    </div>
  </div>
</div>

<!-- Add Exercise Modal -->
<div class="add-ex-modal" id="add-ex-modal">
  <div class="add-ex-sheet" style="position:relative;overflow:hidden">
    <div class="aes-header">
      <div class="aes-title">ADD EXERCISE</div>
      <button class="aes-close" onclick="closeAddExModal()">✕</button>
    </div>
    <div class="aes-search">
      <input type="text" id="aes-search-input" placeholder="Search exercises..." oninput="filterExModal()">
    </div>
    <div class="aes-cats" id="aes-cats">
      <div class="aes-cat active" data-cat="All" onclick="selectExCat(this)">All</div>
    </div>
    <div class="aes-list" id="aes-list"></div>
  </div>
</div>

<!-- Dashboard Exercise Picker (Substitute / Add Superset) -->
<div class="add-ex-modal" id="dash-ex-picker-modal">
  <div class="add-ex-sheet">
    <div class="aes-header">
      <div class="aes-title" id="dash-ex-picker-title">CHOOSE EXERCISE</div>
      <button class="aes-close" onclick="closeDashExPicker()">✕</button>
    </div>
    <div class="aes-search">
      <input type="text" id="dash-ex-picker-search" placeholder="Search exercises..." oninput="filterDashExPicker()">
    </div>
    <div class="aes-filters" id="dash-ex-picker-filters">
      <button class="aes-filter-btn" id="aes-filter-muscle-btn" onclick="toggleAesDropdown('muscle',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        <span id="aes-filter-muscle-label">MUSCLE GROUP</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="10" height="10"><polyline points="6 9 12 15 18 9"/></svg>
      </button>
      <button class="aes-filter-btn" id="aes-filter-equip-btn" onclick="toggleAesDropdown('equip',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="12" height="12"><rect x="11" y="5" width="2" height="14" rx="1"/><rect x="7" y="3" width="4" height="8" rx="1"/><rect x="13" y="3" width="4" height="8" rx="1"/><rect x="2" y="4" width="5" height="6" rx="1.5"/><rect x="17" y="4" width="5" height="6" rx="1.5"/></svg>
        <span id="aes-filter-equip-label">EQUIPMENT</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="10" height="10"><polyline points="6 9 12 15 18 9"/></svg>
      </button>
    </div>
    <div class="aes-list" id="dash-ex-picker-list"></div>
    <!-- Build mode: selected tray + begin button -->
    <div id="aes-build-tray" style="display:none;border-top:1px solid var(--border);padding:14px 16px;background:var(--dark)">
      <div id="aes-build-selected" style="display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px;min-height:28px"></div>
      <button onclick="beginCustomWorkoutFromPicker()" id="aes-begin-btn" style="display:none;width:100%;padding:13px;background:var(--green);border:none;border-radius:10px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;cursor:pointer">BEGIN WORKOUT →</button>
    </div>

    <!-- Quick config overlay — sets/reps/rest before adding to list -->
    <div id="aes-config-overlay" style="display:none;position:absolute;inset:0;background:rgba(0,0,0,0.92);border-radius:inherit;z-index:10;flex-direction:column;align-items:center;justify-content:center;padding:28px 24px">
      <div style="width:100%;max-width:320px">
        <div style="font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--white);margin-bottom:4px" id="aes-config-name">EXERCISE</div>
        <div style="font-size:0.72rem;color:var(--dim);margin-bottom:22px" id="aes-config-muscles"></div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:18px">
          <div>
            <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;color:var(--green);margin-bottom:7px">SETS</div>
            <div style="display:flex;align-items:center;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--card)">
              <button onclick="adjustAesConfig('sets',-1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer">−</button>
              <input id="aes-config-sets" type="number" min="1" max="10" style="flex:1;text-align:center;background:none;border:none;color:var(--white);font-family:'Bebas Neue',sans-serif;font-size:1.4rem;outline:none;width:0;padding:0">
              <button onclick="adjustAesConfig('sets',1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer">+</button>
            </div>
          </div>
          <div>
            <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;color:var(--green);margin-bottom:7px">REPS</div>
            <div style="display:flex;align-items:center;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--card)">
              <button onclick="adjustAesConfig('reps',-1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer">−</button>
              <input id="aes-config-reps" type="number" min="1" max="50" style="flex:1;text-align:center;background:none;border:none;color:var(--white);font-family:'Bebas Neue',sans-serif;font-size:1.4rem;outline:none;width:0;padding:0">
              <button onclick="adjustAesConfig('reps',1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer">+</button>
            </div>
          </div>
        </div>
        <div style="margin-bottom:22px">
          <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;color:var(--dim);margin-bottom:7px">REST (seconds)</div>
          <div style="display:flex;align-items:center;gap:8px">
            <button onclick="adjustAesConfig('rest',-15)" style="flex:1;padding:10px 0;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--white);font-size:0.9rem;cursor:pointer">−15s</button>
            <div id="aes-config-rest-display" style="min-width:52px;text-align:center;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;color:var(--white)">90s</div>
            <input id="aes-config-rest" type="hidden" value="90">
            <button onclick="adjustAesConfig('rest',15)" style="flex:1;padding:10px 0;background:var(--card);border:1px solid var(--border);border-radius:8px;color:var(--white);font-size:0.9rem;cursor:pointer">+15s</button>
          </div>
        </div>
        <div style="display:flex;gap:10px">
          <button onclick="closeAesConfig()" style="flex:1;padding:13px;background:none;border:1px solid var(--border);border-radius:10px;color:var(--dim);font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:1px;cursor:pointer">CANCEL</button>
          <button onclick="confirmAesConfig()" style="flex:2;padding:13px;background:var(--green);border:none;border-radius:10px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;cursor:pointer">ADD TO WORKOUT</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Rest Timer Overlay -->
<div class="rest-overlay" id="rest-overlay">
  <div class="rest-card">
    <div class="rest-label">REST TIME</div>
    <div class="rest-countdown" id="rest-countdown">90</div>
    <div class="rest-sub">seconds remaining</div>
    <button class="btn-skip-rest" onclick="skipRest()">Skip Rest →</button>
  </div>
</div>

<!-- ── SETS/REPS EDITOR MODAL ── -->
<div id="setrepedit-modal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.82);z-index:9500;align-items:center;justify-content:center;padding:20px" onclick="if(event.target===this)closeSetRepEditor()">
  <div style="background:var(--card);border:1px solid var(--border);border-radius:18px;padding:24px 22px;width:100%;max-width:340px" onclick="event.stopPropagation()">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
      <div style="font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--white)" id="sre-ex-name">EXERCISE</div>
      <button onclick="closeSetRepEditor()" style="background:none;border:none;color:var(--dim);font-size:1.2rem;cursor:pointer;padding:2px 6px">✕</button>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:18px">
      <div>
        <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;color:var(--green);margin-bottom:7px">SETS</div>
        <div style="display:flex;align-items:center;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--dark)">
          <button onclick="adjustSRE('sets',-1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer;flex-shrink:0">−</button>
          <input id="sre-sets" type="number" min="1" max="10" style="flex:1;text-align:center;background:none;border:none;color:var(--white);font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:1px;outline:none;width:0;padding:0">
          <button onclick="adjustSRE('sets',1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer;flex-shrink:0">+</button>
        </div>
      </div>
      <div>
        <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;color:var(--green);margin-bottom:7px">REPS</div>
        <div style="display:flex;align-items:center;gap:0;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:var(--dark)">
          <button onclick="adjustSRE('reps',-1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer;flex-shrink:0">−</button>
          <input id="sre-reps" type="number" min="1" max="50" style="flex:1;text-align:center;background:none;border:none;color:var(--white);font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:1px;outline:none;width:0;padding:0">
          <button onclick="adjustSRE('reps',1)" style="width:38px;height:44px;background:none;border:none;color:var(--white);font-size:1.3rem;cursor:pointer;flex-shrink:0">+</button>
        </div>
      </div>
    </div>
    <div style="margin-bottom:18px">
      <div style="font-size:0.6rem;font-weight:700;letter-spacing:2px;color:var(--dim);margin-bottom:7px">REST (seconds)</div>
      <div style="display:flex;align-items:center;gap:8px">
        <button onclick="adjustSRE('rest',-15)" style="padding:8px 14px;background:var(--dark);border:1px solid var(--border);border-radius:8px;color:var(--white);font-size:1rem;cursor:pointer">−15s</button>
        <div id="sre-rest-display" style="flex:1;text-align:center;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:1px;color:var(--white)">90s</div>
        <input id="sre-rest" type="hidden" value="90">
        <button onclick="adjustSRE('rest',15)" style="padding:8px 14px;background:var(--dark);border:1px solid var(--border);border-radius:8px;color:var(--white);font-size:1rem;cursor:pointer">+15s</button>
      </div>
    </div>
    <button onclick="applySetRepEdit()" style="width:100%;padding:13px;background:var(--green);border:none;border-radius:10px;color:var(--black);font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;cursor:pointer">APPLY</button>
  </div>
</div>

<!-- Modular JS -->
<script src="js/app.js"></script>
<script src="js/scoring.js"></script>
<script src="js/logger.js"></script>
<script src="js/coach.js"></script>
<script>_bootApp();</script>

</body>
</html>
